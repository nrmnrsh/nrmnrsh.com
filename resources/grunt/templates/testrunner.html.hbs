<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Testrunner</title>

		<!-- PhantomJS doesn't support ES5 features. Add Shim to fix this issue... -->
		<script type="text/javascript" src="/jspm_packages/github/es-shims/es5-shim@4.5.2/es5-shim.js"></script>

		<!-- Add Qunit -->
		<link rel="stylesheet" href="/jspm_packages/github/qunitjs/qunit@1.20.0/qunit/qunit.css" />
		<script type="text/javascript" src="/jspm_packages/github/qunitjs/qunit@1.20.0/qunit/qunit.js"></script>

		<!-- Add SystemJs and configuration -->
		<script type="text/javascript" src="/jspm_packages/system.js"></script>
		<script type="text/javascript" src="/config.js"></script>

		<!-- Re-Configure all campaign paths in config, if exisits -->
		<script type="text/javascript">{{#each paths}}
			System.paths['{{@key}}'] = '{{this}}';{{/each}}
		</script>

		<!-- Gettext mock -->
		<script type="text/javascript">
			window.gettext = window.gettext || function(label) {
				return label;
			};
			window.i18next = window.i18next || {};
			window.i18next.t = window.i18next.t || function(label, props) {
				if (typeof props === 'object') {
					Object.keys(props).forEach(function(key) {
						var re = new RegExp('{' + '{ ?' + key + ' ?}' + '}', 'g');
						label = label.replace(re, props[key])
					});
				}

				return label;
			};
		</script>

		<!-- Load tests -->
		<script type="text/javascript">
			QUnit.config.autostart = false;
			System.import('lolex')
				.then(function(lolex) { window.lolex = lolex; })
				.then(function() {
					System.import('sinon')
						.then(function(sinon) { window.sinon = sinon; })
						.then(function() {
							Promise.all([
								System.import('sinon-qunit'),{{#each tests}}
								System.import('{{ this }}'){{#unless @last }},{{/unless}}{{/each}}
							]).then(function() {
								QUnit.start();
							});
						});
				});
		</script>
	</head>
	<body>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
	</body>
</html>
